(function(){"use strict";function overlayManager($rootScope,overlayService,uSyncItemManager){function insertPublishCmds(content){var contentForm,formScope,button;content!==undefined&&(mgr.content=content);contentForm=angular.element(document).find('[name="contentForm"]');contentForm!=null&&(formScope=findScope($rootScope),formScope!=null&&_.contains(formScope.content.allowedActions,"^")&&formScope.subButtons!==null&&(_.some(formScope.subButtons,function(b){return b.letter=="SYNCPUB"})||(button={letter:"SYNCPUB",labelKey:"usyncpublish_publishButton",handler:publishToSite,alias:"usyncSitePublish",addEllipsis:"true"},formScope.subButtons.splice(1,0,button))))}function findScope(scope){if(!scope)return null;var contentScope=null;return scope.subButtons!==undefined&&scope.content!==undefined?scope:(scope.$$childHead!==null&&(contentScope=findScope(scope.$$childHead)),contentScope===null&&scope.$$nextSibling!==null&&(contentScope=findScope(scope.$$nextSibling)),contentScope)}function publishToSite(){var treeItem={id:mgr.content.id,treeAlias:"content",sectionAlias:"content"};uSyncItemManager.getEntity(treeItem).then(function(result){var options={items:[result.data],treeItem:treeItem};openPublishDialog(options)})}function openPublishDialog(options){var overlay={title:"Publish to server...",subtitle:"Select which server you wish to publish the content to",view:Umbraco.Sys.ServerVariables.uSyncPublisher.pluginPath+"overlay/overlayDialog.html",isModal:!0,mode:"Push",server:{},options:options,disableBackdropClick:!0,disableEscKey:!0,skipFormValidation:!0,disableSubmitButton:!0,submitButtonLabel:"Continue",closeButtonLabel:"Close",submit:function(){this.isComplete!=null&&this.isComplete()?($scope.$broadcast("usync-publish-close"),overlayService.close()):this.moveToNext!=null&&this.moveToNext()},close:function(){overlayService.close()}};overlayService.open(overlay)}var mgr={};return{insertPublishCmds:insertPublishCmds}}angular.module("umbraco").factory("uSyncPublishOverlayManager",overlayManager)})()