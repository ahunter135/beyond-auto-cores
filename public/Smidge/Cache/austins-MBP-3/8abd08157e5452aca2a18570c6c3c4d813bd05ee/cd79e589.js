(function(){"use strict";function addServerController($rootScope,$scope,notificationsService,uSyncPublishService,uSyncPublishServerManager){function init(){getSettings();loadTemplates()}function getSettings(){uSyncPublishService.getSettings().then(function(result){vm.settings=result.data;vm.settings.hasAppId||uSyncPublishServerManager.createLocalApiKeys()})}function loadTemplates(){uSyncPublishService.getTemplates().then(function(result){vm.templates=result.data},function(){})}function select(template){vm.templates.forEach(function(t){t.selected=!1});template.selected=!0;vm.selected=!0;vm.server.icon=template.icon;vm.server.enabled=!0;vm.server.pullEnabled=!0;vm.server.sendSettings=template.flags;vm.server.publisher=template.publisher;vm.server.publisherConfig=template.publisherConfig}function urlChange(){vm.showCheck=!1}function nameChange(){vm.server.name!=null&&(vm.server.alias=vm.server.name.toUmbracoAlias())}function checkServer(){vm.server.url!=undefined&&(vm.checkState="busy",vm.server.url=vm.server.url.trimEnd("/"),uSyncPublishServerManager.checkServerByUrl(vm.server.url,function(status){vm.status=status;vm.checkState=status.Status==="Success"?"success":"error";vm.checked=!0;vm.showCheck=!0}))}function setupServer(){uSyncPublishServerManager.remoteSetup(vm.server,function(success){success&&checkServer()})}function close(){$scope.model.close&&$scope.model.close()}function save(){uSyncPublishService.saveServer(vm.server).then(function(){vm.buttonState="success";notificationsService.success("Saved",vm.server.alias+" server settings have been updated");$rootScope.$broadcast("usync-publish-serverSave")},function(error){vm.buttonState="error";notificationsService.error("error",error.data.exceptionMessage)});$scope.model.submit&&$scope.model.submit(vm.server)}var vm=this;vm.loading=!1;vm.selected=!1;vm.checked=!1;vm.showCheck=!1;vm.dialog={title:"Add Server",description:"Connect to a new server"};vm.server={name:"",placeholder:$scope.model.placeholder,url:$scope.model.url};$scope.model.url!==undefined&&(vm.server.url=$scope.model.url);vm.checkState="init";vm.close=close;vm.save=save;vm.select=select;vm.nameChange=nameChange;vm.urlChange=urlChange;vm.setupServer=setupServer;vm.checkServer=checkServer;init()}angular.module("umbraco").controller("uSyncAddServerController",addServerController)})()