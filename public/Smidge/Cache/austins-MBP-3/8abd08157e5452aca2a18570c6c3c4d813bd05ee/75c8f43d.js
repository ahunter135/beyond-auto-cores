(function(){"use static";function dashboardSettingsController($scope,notificationsService,uSyncPublishService,uSyncPublishServerManager,uSyncSettingManager){function save(){saveSettings()}function getSettings(){uSyncPublishService.getSettings().then(function(result){vm.loading=!1;vm.settings=result.data;vm.server=vm.settings.server;initPicker();vm.settings.hasAppId||uSyncPublishServerManager.createLocalApiKeys()});uSyncPublishService.getPublishers().then(function(result){vm.publishers=result.data})}function reloadSettings(quite){vm.loading=!0;vm.saveState="busy";uSyncPublishService.reloadSettings().then(function(result){vm.saveState="success";vm.loading=!1;vm.settings=result.data;initPicker();quite||notificationsService.add({type:"info",headline:"Reload",message:"Settings reloaded from disk"})})}function saveSettings(){vm.saveState="busy";vm.settings.server=vm.server;uSyncPublishService.saveSettings(vm.settings).then(function(){vm.saveState="success";notificationsService.success("Save","uSync publisher settings saved")},function(error){vm.saveState="error";notificationsService.error("Error",error.data.ExceptionMessage)})}function copyText(){var copyItem=document.getElementById("serverUrl");copyItem.select();copyItem.setSelectionRange(0,99999);document.execCommand("copy");notificationsService.success("Copied","Server url copied to clipboard")}function initPicker(){vm.userGroupPicker={value:vm.server.sendSettings,view:Umbraco.Sys.ServerVariables.uSyncPublisher.pluginPath+"pickers/userGroupPicker.html",validation:{mandatory:!1},config:{}};(vm.server.allowedServers===undefined||vm.server.allowedServers===null)&&(vm.settings.allowedServers=[]);vm.allowedPicker={value:vm.server.allowedServers,view:Umbraco.Sys.ServerVariables.uSyncPublisher.pluginPath+"serverPicker/picker.html",validation:{mandatory:!0},config:{multiPicker:!1}}}function createKeys(){uSyncPublishService.createKeys().then(function(result){vm.saveState="success";uSyncSettingManager.showAppSettings("usyncpublish_securityKey","usyncpublish_createKeyIntro",result.data.json)})}var vm=this,unsubscribe;vm.loading=!0;vm.server={};vm.settings={};vm.saveState="init";vm.showAdvanced=!0;vm.save=save;vm.reloadSettings=reloadSettings;vm.createKeys=createKeys;vm.copyText=copyText;vm.groups=[];vm.userGroupPicker={};getSettings();unsubscribe=[];unsubscribe.push($scope.$on("usync-publisher-settings-save",function(){saveSettings()}));unsubscribe.push($scope.$on("usync-publisher-settings-reload",function(){reloadSettings(!0)}));$scope.$on("$destroy",function(){for(var u in unsubscribe)unsubscribe[u]()});unsubscribe=[];unsubscribe.push($scope.$watch("vm.publisher",function(newValue){if(newValue!==undefined){var pub=_.find(vm.publishers,function(pub){return pub.alias===newValue});pub!=null&&(vm.publisherDescription=pub.description)}}));$scope.$on("$destroy",function(){for(var u in unsubscribe)unsubscribe[u]()})}angular.module("umbraco").controller("uSyncPublisherSettingsController",dashboardSettingsController)})()