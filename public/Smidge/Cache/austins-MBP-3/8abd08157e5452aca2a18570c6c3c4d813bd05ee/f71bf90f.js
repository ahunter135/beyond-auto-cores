(function(){"use strict";function exporterDashboardController($scope,$q,editorService,overlayService,uSyncExportManager,uSyncExporterService){function init(){vm.loading=!0;var promises=[];promises.push(uSyncExporterService.isLicenced().then(function(result){vm.licenced=result.data}));promises.push(uSyncExporterService.getSettings().then(function(result){vm.version=result.data.version;vm.includeFiles=result.data.includeFiles;vm.includeMedia=result.data.includeMedia;vm.includeLinked=result.data.includeLinked}));promises.push(uSyncExporterService.getExporters().then(function(result){vm.exporters=result.data}));$q.all(promises).then(function(){vm.loading=!1})}function openImportDialog(){uSyncExportManager.openImportDialog({entity:{id:-1,name:"uSync Pack"}},null)}function createExport(){var overlay={options:{selection:vm.selection,includeFiles:vm.includeFiles,includeMedia:vm.includeMedia,includeLinked:vm.includeLinked,includeConfig:vm.includeConfig},view:Umbraco.Sys.ServerVariables.uSync.exporterPluginPath+"/exportoverlay.html",title:"Create sync pack",subtitle:"Create a sync pack of the items you want to export",disableBackdropClick:!0,disableEscKey:!0,submitButtonLabel:"Create",closeButtonLabel:"Close",submit:function(model){model.create!==null&&model.create!==undefined&&model.create()},close:function(){overlayService.close()}};overlayService.open(overlay)}function pickTypes(exporter){var options={section:exporter.section,title:"Add "+exporter.type,treeAlias:exporter.type,multiPicker:!0,size:"small",view:exporter.view,idType:"int",submit:function(model){vm.selection=vm.selection.concat(prepSelection(model.selection,exporter.entityType));cleanSelection();editorService.close()},close:function(){editorService.close()},select:function(node){node.selected=node.selected===!0?!1:!0;multiSelectItem(node,this.selection,exporter.entityType)},selection:vm.selection};exporter.blockContainers&&(options.filter=function(i){return i.metaData.isContainer},options.filterCssClass="not-allowed");editorService.treePicker(options)}function cleanSelection(){vm.selection=_.uniq(vm.selection,!1,function(s){return s.id+s.name})}function prepSelection(selection,entityType){if(selection.length>0)for(let n=0;selection.length>n;n++)prepItem(selection[n],entityType);return selection}function prepItem(item,entityType){item.flags={includeChildren:!1,includeAncestors:!0,includeDependencies:!0};item.entityType=entityType;entityType!==undefined&&item.udi==null&&(item.id=cleanId(item.id));switch(item.nodeType){case"media":case"content":case"container":item.flags.includeChildren=!0;break;case"templates":item.flags.includeFiles=!0;break;case"dictionary":item.flags.includeAncestors=!1;item.flags.includeDependencies=!1;break;case"templates":item.flags.includeContent=!0;break;default:item.hasChildren===!0&&(item.flags.includeChildren=!0)}}function cleanId(id){return id.replaceAll("+","%20").replaceAll("%2F","/")}function findItem(id,selection){if(selection.length>0)for(let n=0;selection.length>n;n++)if(selection[n].id===id)return n;return-1}function multiSelectItem(item,selection,entityType){var index=findItem(item.id,selection);index!=-1?selection.splice(index,1):(prepItem(item,entityType),selection.push(item))}function remove(id){var index=findItem(id,vm.selection);index!=-1&&vm.selection.splice(index,1)}function showHelp(title,view){vm.help={title:title,subtitle:"uSync exporter help",view:Umbraco.Sys.ServerVariables.uSync.exporterPluginPath+"/help/"+view+".html",show:!0,hideSubmitButton:!0,submit:function(){vm.help.show=!1;vm.help={}},close:function(){vm.help.show=!1;vm.help={}}}}var vm=this;vm.licenced=!1;vm.loading=!0;vm.selection=[];vm.showHelp=showHelp;vm.pickTypes=pickTypes;vm.createExport=createExport;vm.remove=remove;vm.openImportDialog=openImportDialog;vm.disableImport=Umbraco.Sys.ServerVariables.uSync.exporterDisableImport;init()}angular.module("umbraco").controller("uSyncExporterDashboardController",exporterDashboardController)})()