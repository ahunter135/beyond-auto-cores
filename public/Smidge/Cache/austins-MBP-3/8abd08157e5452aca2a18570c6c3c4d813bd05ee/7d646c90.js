(function(){"use strict";function publishResultController($scope,editorService){function openDetail(item){if(vm.isModal)item.show=!item.show;else{var options={item:item,server:vm.server,title:"uSync Change",view:Umbraco.Sys.ServerVariables.application.applicationPath+"App_Plugins/uSyncPublisher/dialogs/detail.html",close:function(){editorService.close()}};editorService.open(options)}}function getTypeName(typeName){var umbType=typeName.substring(typeName.lastIndexOf(".")+1);return umbType[0]=="I"?umbType.substring(1):umbType}function groupByType(results){var groups=[];results.map(function(item){var found=!1,newGroup;groups.forEach(function(group){group.type===item.itemType&&(group.items.push(item),found=!0)});found||(newGroup={type:item.itemType,name:getTypeName(item.itemType),items:[],showGroup:!1},newGroup.items.push(item),groups.unshift(newGroup))});for(let i=0;i<groups.length;i++)groups[i].itemCount=itemCount(groups[i].items),groups[i].changes=changeCount(groups[i].items);return groups.length>0&&(groups[0].showGroup=!0),groups}function itemCount(results){var count=0;for(let i=0;i<results.length;i++)results[i].change!=="Clean"&&count++;return count}function totalChanges(){var total=0,noChange=[];return angular.forEach(vm.groups,function(group){var changes=changeCount(group.items),item;total+=changes;changes===0&&(item=group.name[group.name.length-1]==="e"?group.name+"s":group.name,noChange.push(item+" ("+group.items.length+")"))}),vm.noChangeList=noChange.join(", "),total}function changeCount(changes){var count=0;return angular.forEach(changes,function(val){val.change!=="NoChange"&&val.change!=="Clean"&&count++}),count}function showResult(result){return result.change!=="Clean"&&result.change!=="NoChange"}var vm=this;vm.getTypeName=getTypeName;vm.showResult=showResult;vm.openDetail=openDetail;vm.groups=[];vm.total=0;vm.noChangeList="";vm.$onInit=function(){vm.groups=groupByType(vm.results);vm.total=totalChanges()}}var publishResultComponent={templateUrl:Umbraco.Sys.ServerVariables.application.applicationPath+"App_Plugins/uSyncPublisher/components/uSyncPublishResult.html",bindings:{results:"<",total:"=",isModal:"<",server:"<"},controllerAs:"vm",controller:publishResultController};angular.module("umbraco").component("usyncPublishResultView",publishResultComponent)})()