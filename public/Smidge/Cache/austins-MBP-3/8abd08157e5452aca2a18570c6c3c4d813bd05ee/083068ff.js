(function(){"use strict";function uSyncBrowserController($scope,editorService){function selectLayout(layout){vm.activeLayout=layout;vm.layouts.forEach(e=>e.active=!1);layout.active=!0}function onBreadcrumbItem(item,$index){if($index<vm.breadcrumb.length-1){var pos=$index+1;vm.breadcrumb.splice(pos,vm.breadcrumb.length-pos);vm.loadFolder({key:vm.breadcrumb[vm.breadcrumb.length-1].key})}}function onClickItem(item,$event){$event.preventDefault();$event.stopPropagation();item.selected=!item.selected;var alreadySelected=!1;for(let i=0;i<vm.selection.length;i++)vm.selection[i].udi==item.udi&&(item.selected?alreadySelected=!0:vm.selection.splice(i,1));item.selected&&!alreadySelected&&vm.selection.push(item.localItem)}function onClickItemName(item,$event){$event.preventDefault();$event.stopPropagation();item.isFolder&&item.hasChildren&&vm.loadFolder?(vm.breadcrumb.push({key:item.key,name:item.name}),vm.loadFolder({key:item.key})):onClickItem(item,$event)}function getChangeName(action){var name=vm.changeNames[action.change];return name==null||name===undefined?action.change:name}function activate(){for(var i=0;vm.items.nodes.length>i;i++)setOriginalSize(vm.items.nodes[i])}function setOriginalSize(item){item.height!==undefined&&item.width!==undefined&&(item.width=itemDefaultWidth,item.height=itemDefaultHeight,item.aspectRatio=1,item.aspectRatio=item.width/item.height,item.aspectRatio>=1?item.width>itemMaxWidth&&(item.width=itemMaxWidth,item.height=itemMaxWidth/item.aspectRatio):item.height>itemMaxHeight&&(item.height=itemMaxHeight,item.width=itemMaxHeight*item.aspectRatio))}function openDetail(action,$event){$event.preventDefault();$event.stopPropagation();var options={item:action,server:vm.server,viewFirst:!0,title:"uSync Change",view:Umbraco.Sys.ServerVariables.application.applicationPath+"App_Plugins/uSyncPublisher/dialogs/detail.html",close:function(){editorService.close()}};editorService.open(options)}function openSideBySide(item,$event){$event.preventDefault();$event.stopPropagation();editorService.open({view:Umbraco.Sys.ServerVariables.uSyncPublisher.pluginPath+"dialogs/sideBySide.html",title:"Side by Side",source:item.localUrl,target:item.remoteUrl,size:"",submit:function(){editorService.close()},close:function(){editorService.close()}})}var vm=this,evts;vm.onClickItem=onClickItem;vm.onClickItemName=onClickItemName;vm.onBreadcrumbItem=onBreadcrumbItem;vm.rootKey="00000000-0000-0000-0000-000000000000";vm.breadcrumb=[{key:vm.rootKey,name:"Media"}];vm.getChangeName=getChangeName;vm.current=vm.rootKey;vm.openDetail=openDetail;vm.openSideBySide=openSideBySide;vm.selectLayout=selectLayout;vm.changeNames={NoChange:"In sync",Update:"Diffrent",Delete:"Not on target",Create:"No on local"};var itemDefaultHeight=200,itemDefaultWidth=200,itemMaxWidth=200,itemMaxHeight=200;evts=[];evts.push($scope.$watch("vm.items",function(newValue){newValue!==undefined&&_.isArray(newValue.nodes)&&(newValue.key===vm.rootKey&&(vm.breadcrumb=[vm.breadcrumb[0]]),activate())}));evts.push($scope.$watch("vm.serverName",function(name){name!==undefined&&(vm.breadcrumb[0].name=vm.type+" ["+name+"]")}));$scope.$on("$destroy",function(){for(var e in evts)evts[e]()})}var uSyncItemBrowserComponent={templateUrl:Umbraco.Sys.ServerVariables.application.applicationPath+"App_Plugins/uSyncPublisher/components/uSyncItemBrowser.html",bindings:{items:"=",selection:"=",loadFolder:"&",loading:"=",server:"=",type:"@",layouts:"=",activeLayout:"="},controllerAs:"vm",controller:uSyncBrowserController};angular.module("umbraco").component("usyncItemBrowser",uSyncItemBrowserComponent)})()